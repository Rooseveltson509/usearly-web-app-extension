{"version":3,"file":"background.js","mappings":";;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,+DAA+D,4CAA4C;AAC3G;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD,kCAAkC;AAC1F;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD,mCAAmC;AAC3F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,EAAE;;;;;;;;;;;;;;;;;AC9EF;AACO;AACP,+BAA+B,cAAc;AAC7C;AACA,KAAK;AACL;AACA;AACO;AACP;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACO;AACP;AACA;AACA,KAAK;AACL;;;;;;;UCpBA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;;;;;;;;;ACNA,iBAAiB,SAAI,IAAI,SAAI;AAC7B,4BAA4B,+DAA+D,iBAAiB;AAC5G;AACA,oCAAoC,MAAM,+BAA+B,YAAY;AACrF,mCAAmC,MAAM,mCAAmC,YAAY;AACxF,gCAAgC;AAChC;AACA,KAAK;AACL;AACA,mBAAmB,SAAI,IAAI,SAAI;AAC/B,cAAc,6BAA6B,0BAA0B,cAAc,qBAAqB;AACxG,iBAAiB,oDAAoD,qEAAqE,cAAc;AACxJ,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC;AACxC,mCAAmC,SAAS;AAC5C,mCAAmC,WAAW,UAAU;AACxD,0CAA0C,cAAc;AACxD;AACA,8GAA8G,OAAO;AACrH,iFAAiF,iBAAiB;AAClG,yDAAyD,gBAAgB,QAAQ;AACjF,+CAA+C,gBAAgB,gBAAgB;AAC/E;AACA,kCAAkC;AAClC;AACA;AACA,UAAU,YAAY,aAAa,SAAS,UAAU;AACtD,oCAAoC,SAAS;AAC7C;AACA;AACsE;AACb;AACzD;AACA;AACA;AACA;AACA;AACA,kCAAkC;AAClC,IAAI;AACJ,iCAAiC;AACjC;AACA,CAAC,GAAG;AACJ;AACA;AACA,YAAY,sEAAc;AAC1B;AACA;AACA;AACA,0BAA0B,cAAc;AACxC;AACA,aAAa;AACb;AACA;AACA;AACA,2EAA2E,QAAQ;AACnF,iBAAiB;AACjB,aAAa,WAAW;AACxB;AACA;AACA,CAAC;AACD;AACA;AACA;AACA,IAAI,+DAAW;AACf;AACA;AACA,KAAK;AACL;AACA;AACA,0BAA0B;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC;AACpC;AACA;AACA,SAAS;AACT;AACA,KAAK;AACL,CAAC,IAAI,WAAW;AAChB;AACA;AACA;AACA;AACA,0CAA0C,4BAA4B;AACtE;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA,wCAAwC,iBAAiB;AACzD;AACA;AACA,8DAA8D,eAAe;AAC7E;AACA;AACA,2CAA2C,yDAAyD;AACpG;AACA;AACA,2CAA2C,iCAAiC;AAC5E;AACA,qBAAqB;AACrB;AACA;AACA,mCAAmC,oDAAoD;AACvF;AACA,aAAa;AACb,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,0CAA0C;AAC7E,iBAAiB,SAAS;AAC1B;AACA;AACA,+BAA+B,oCAAoC;AACnE;AACA,2CAA2C,kCAAkC;AAC7E,iBAAiB;AACjB,gDAAgD,yBAAyB;AACzE;AACA;AACA,6CAA6C;AAC7C;AACA,wBAAwB,4DAAQ;AAChC,mDAAmD,uBAAuB,GAAG;AAC7E;AACA,uCAAuC,eAAe;AACtD;AACA;AACA;AACA,uCAAuC,mDAAmD;AAC1F;AACA,iBAAiB;AACjB;AACA;AACA;AACA,mCAAmC,sCAAsC;AACzE,iBAAiB;AACjB;AACA;AACA;AACA,+BAA+B,yCAAyC;AACxE;AACA,yBAAyB;AACzB;AACA,4BAA4B;AAC5B,2BAA2B,eAAe;AAC1C;AACA;AACA;AACA,YAAY,4DAAQ;AACpB,+BAA+B,0BAA0B;AACzD,aAAa;AACb,yBAAyB;AACzB;AACA;AACA,2BAA2B,eAAe;AAC1C;AACA;AACA;AACA,2BAA2B,8CAA8C;AACzE;AACA;AACA,CAAC","sources":["webpack://usearly-extension-react/./src/utils/blockAdultSites.ts","webpack://usearly-extension-react/./src/utils/storageUtil.ts","webpack://usearly-extension-react/webpack/bootstrap","webpack://usearly-extension-react/webpack/runtime/define property getters","webpack://usearly-extension-react/webpack/runtime/hasOwnProperty shorthand","webpack://usearly-extension-react/webpack/runtime/make namespace object","webpack://usearly-extension-react/./src/background.ts"],"sourcesContent":["// Liste noire de domaines connus pour adultes\nvar forbiddenDomains = [\n    \"exampleporn.com\",\n    \"violentsite.com\",\n    \"adult-content.com\",\n    \"badsites.net\",\n    \"pornhub.com\",\n    \"xvideos.com\",\n    \"redtube.com\",\n    \"xnxx.com\",\n    \"youporn.com\",\n    \"brazzers.com\",\n    \"adultfriendfinder.com\",\n    \"livejasmin.com\",\n    \"airbnb.fr\"\n];\nvar forbiddenKeywords = [\n    \"porn\",\n    \"violent\",\n    \"xxx\",\n    \"inappropriate\",\n    \"nsfw\",\n    \"sex\",\n    \"erotic\"\n];\n// https://www.airbnb.fr/rooms/52621429?adults=2&category_tag=Tag%3A4104&children=0&enable_m3_private_room=true&infants=0&pets=0&photo_id=1667039872&search_mode=flex_destinations_search&check_in=2025-01-03&check_out=2025-01-08&source_impression_id=p3_1732287557_P3IQ3z7DTBGIxxhx&previous_page_section_name=1000\n// Liste de mots-clés sensibles dans les URLs\n/**\n * Vérifie si le site actuel doit être bloqué.\n * @param url L'URL complète de la page web.\n * @returns true si le site est inapproprié, sinon false.\n */\nexport function shouldBlockUrl(url) {\n    try {\n        // Créer une instance d'URL\n        var parsedUrl = new URL(url);\n        // Extraire le domaine (hostname)\n        var domain_1 = parsedUrl.hostname.toLowerCase();\n        // Vérifier si le domaine est dans la liste interdite\n        if (forbiddenDomains.some(function (forbiddenDomain) { return domain_1.includes(forbiddenDomain); })) {\n            console.log(\"URL bloqu\\u00E9e : Domaine interdit (\".concat(domain_1, \")\"));\n            return true;\n        }\n        // Extraire le chemin complet (path)\n        var path_1 = parsedUrl.pathname.toLowerCase();\n        // Vérifier si un mot-clé interdit est dans le chemin\n        if (forbiddenKeywords.some(function (keyword) { return path_1.includes(keyword); })) {\n            console.log(\"URL bloqu\\u00E9e : Mot-cl\\u00E9 interdit dans le chemin (\".concat(path_1, \")\"));\n            return true;\n        }\n        // Extraire les paramètres de requête (query string)\n        var query_1 = parsedUrl.search.toLowerCase();\n        // Vérifier si un mot-clé interdit est dans les paramètres de requête\n        if (forbiddenKeywords.some(function (keyword) { return query_1.includes(keyword); })) {\n            console.log(\"URL bloqu\\u00E9e : Mot-cl\\u00E9 interdit dans les param\\u00E8tres (\".concat(query_1, \")\"));\n            return true;\n        }\n        // Si aucune condition de blocage n'est satisfaite, autoriser l'accès\n        console.log(\"URL autoris\\u00E9e : \".concat(url));\n        return false;\n    }\n    catch (error) {\n        console.error(\"Erreur lors de l'analyse de l'URL : \".concat(error));\n        return true; // Bloquer par défaut en cas d'erreur\n    }\n}\n/* export function isAdultSite(url: string): boolean {\n    const domain = new URL(url).hostname.toLowerCase();\n\n    // Vérifie si le domaine ou l'URL contient des contenus sensibles\n    if (\n        forbiddenDomains.some((blockedDomain) => domain.includes(blockedDomain)) ||\n        forbiddenKeywords.some((keyword) => url.toLowerCase().includes(keyword))\n    ) {\n        return true;\n    }\n\n    return false;\n} */\n","// Enregistrement du token\nexport function setToken(token) {\n    chrome.storage.local.set({ token: token }, function () {\n        console.log(\"Token enregistré dans chrome.storage\");\n    });\n}\n// Récupération du token\nexport function getToken() {\n    return new Promise(function (resolve) {\n        chrome.storage.local.get([\"token\"], function (result) {\n            console.log(\"Token récupéré depuis le stockage:\", result.token);\n            resolve(result.token || null);\n        });\n    });\n}\n// Suppression du token\nexport function removeToken() {\n    chrome.storage.local.remove(\"token\", function () {\n        console.log(\"Token supprimé de chrome.storage\");\n    });\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { setToken, removeToken, getToken } from './utils/storageUtil';\nimport { shouldBlockUrl } from \"./utils/blockAdultSites\";\nvar API_URL = 'https://usearly-api.vercel.app/api/v1';\nvar FIVE_HOURS_IN_MS = 5 * 60 * 60 * 1000;\n/* chrome.tabs.onUpdated.addListener((tabId, changeInfo, tab) => {\n  if (tab.url && shouldBlockUrl(tab.url)) {\n    console.log(\"Site bloqué : désactivation de l'extension.\");\n    chrome.action.disable(tabId); // Désactive l'icône de l'extension\n  } else {\n    chrome.action.enable(tabId); // Active l'icône de l'extension\n  }\n}); */\nchrome.tabs.onUpdated.addListener(function (tabId, changeInfo, tab) {\n    if (changeInfo.status === 'complete' && tab.url) {\n        if (shouldBlockUrl(tab.url)) {\n            // Envoie un message au content script pour afficher le popup\n            // Injecte le content script pour flouter les médias\n            chrome.scripting.executeScript({\n                target: { tabId: tabId },\n                files: [\"contentScript.js\"], // Assurez-vous que le fichier est compilé en JS\n            });\n            // Ferme l'onglet après un délai de 3 secondes\n            /* setTimeout(() => {\n                chrome.tabs.remove(tabId, () => {\n                    console.log(`Onglet fermé pour contenu inapproprié : ${tab.url}`);\n                });\n            }, 10000);  */ // Délai de 3 secondes avant la fermeture\n        }\n    }\n});\n// Fonction de déconnexion\nfunction handleLogout() {\n    console.log(\"Déconnexion automatique ou manuelle de l'utilisateur.\");\n    removeToken();\n    chrome.storage.local.remove(['authToken', 'loginTime'], function () {\n        console.log('Token et heure de connexion supprimés.');\n    });\n}\n// Vérifie périodiquement si 5 heures se sont écoulées depuis la connexion\nsetInterval(function () { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        chrome.storage.local.get(['loginTime'], function (result) {\n            var loginTime = result.loginTime || null;\n            if (loginTime) {\n                var elapsedTime = Date.now() - loginTime;\n                console.log(\"Temps \\u00E9coul\\u00E9 : \".concat(elapsedTime / 1000, \" secondes\"));\n                if (elapsedTime >= FIVE_HOURS_IN_MS) {\n                    handleLogout(); // Appelle la fonction de déconnexion\n                }\n            }\n        });\n        return [2 /*return*/];\n    });\n}); }, 300000); // Vérifie toutes les 5 minutes\nchrome.action.onClicked.addListener(function (tab) {\n    console.log(\"Icône de l'extension cliquée.\", tab);\n    console.log(\"Envoi du message à content.js...\");\n    if (tab.id) {\n        chrome.tabs.sendMessage(tab.id, { action: \"showFloatingMenu\" }, function (response) {\n            if (chrome.runtime.lastError) {\n                console.error(\"Erreur de communication avec content.js :\", chrome.runtime.lastError.message);\n            }\n            else {\n                console.log(\"Réponse de content.js :\", response);\n            }\n        });\n    }\n    else {\n        console.error(\"Aucun onglet actif trouvé !\");\n    }\n});\n// Gestion des messages entrants\nchrome.runtime.onMessage.addListener(function (message, sender, sendResponse) {\n    console.log(\"Message reçu dans le script de fond :\", message);\n    switch (message.action) {\n        case \"captureTab\":\n            chrome.windows.getCurrent({ populate: false }, function (window) {\n                var windowId = window === null || window === void 0 ? void 0 : window.id;\n                if (typeof windowId === \"number\") {\n                    chrome.tabs.captureVisibleTab(windowId, { format: \"png\" }, function (dataUrl) {\n                        if (chrome.runtime.lastError) {\n                            console.log(\"Erreur de capture d'onglet :\", chrome.runtime.lastError.message);\n                            sendResponse({ success: false, error: chrome.runtime.lastError.message });\n                        }\n                        else {\n                            sendResponse({ success: true, dataUrl: dataUrl });\n                        }\n                    });\n                }\n                else {\n                    sendResponse({ success: false, error: \"ID de fenêtre non valide.\" });\n                }\n            });\n            return true; // Assurez-vous de retourner `true` pour les réponses asynchrones\n        case \"login\":\n            var email = message.email, password = message.password;\n            console.log(\"Tentative de connexion pour l'utilisateur :\", email);\n            try {\n                var timeout_1 = setTimeout(function () {\n                    console.log(\"Timeout pour la requête de connexion.\");\n                    sendResponse({ success: false, error: 'Request timeout' });\n                }, 5000); // Timeout de 5 secondes\n                fetch(\"\".concat(API_URL, \"/user/login\"), {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    mode: 'cors',\n                    body: JSON.stringify({ email: email, password: password }),\n                })\n                    .then(function (response) { return response.json(); })\n                    .then(function (data) {\n                    console.log(\"data: \", data);\n                    clearTimeout(timeout_1); // Annule le timeout si la réponse arrive\n                    if (data.token) {\n                        setToken(data.token);\n                        chrome.storage.local.set({ loginTime: Date.now() }); // Enregistre l'heure de connexion\n                        console.log(\"Connexion réussie. Token stocké.\");\n                        sendResponse({ success: true });\n                    }\n                    else {\n                        console.log(\"Échec de l'authentification : aucun token reçu.\");\n                        sendResponse({ success: false, error: 'Authentification échouée' });\n                    }\n                })\n                    .catch(function (error) {\n                    clearTimeout(timeout_1);\n                    console.log(\"Erreur de connexion :\", error);\n                    sendResponse({ success: false, error: error.message });\n                });\n            }\n            catch (error) {\n                console.log(\"Erreur inattendue :\", error);\n                sendResponse({ success: false, error: 'Erreur interne' });\n            }\n            return true; // Retourner `true` pour les opérations asynchrones\n        case \"logout\":\n            handleLogout(); // Appelle la fonction de déconnexion\n            sendResponse({ success: true });\n            return false;\n        case \"isAuthenticated\":\n            console.log(\"Vérification de l'authentification de l'utilisateur.\");\n            getToken().then(function (token) {\n                sendResponse({ isAuthenticated: !!token });\n            });\n            return true; // Permet la réponse asynchrone\n        case \"test\":\n            console.log(\"Message de test reçu du script de contenu.\");\n            sendResponse({ success: true });\n            return false;\n        default:\n            console.log(\"Action non reconnue :\", message.action);\n            sendResponse({ success: false, error: \"Action non reconnue\" });\n            return false;\n    }\n});\n"],"names":[],"sourceRoot":""}